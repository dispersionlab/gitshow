'use strict';

var _require = require('diff');

var diffWordsWithSpace = _require.diffWordsWithSpace;

var _require2 = require('./lib/list');

var formatLists = _require2.formatLists;
var parseLists = _require2.parseLists;

var _require3 = require('./lib/util');

var wrapChange = _require3.wrapChange;


module.exports = function richDiff(str1, str2) {
  var _parseLists = parseLists(str1);

  var text1 = _parseLists.text;
  var list1 = _parseLists.list;

  var _parseLists2 = parseLists(str2);

  var text2 = _parseLists2.text;
  var list2 = _parseLists2.list;


  return diffWordsWithSpace(text1, text2).map(function (_ref) {
    var value = _ref.value;
    var added = _ref.added;
    var removed = _ref.removed;

    var hasList = value.includes('{{{LIST}}}');
    var hasChange = added ^ removed ? !!added : null;
    if (hasList) {
      return formatLists(value, list1, list2, hasChange);
    }
    return wrapChange(value, hasChange);
  }).join('');
};